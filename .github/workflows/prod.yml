name: Deploy application 

on: 
    push:
        branches: ["main"]


jobs:
    build:
        runs-on: ubuntu-latest
        steps:
              - name: Checkout code
                uses: actions/checkout@v3
             
              - name: Setup Java
                uses: actions/setup-java@v3
                with:
                    distribution: 'temurin' 
                    java-version: '17'
              - name: Build project
                run: mvn clean install -DskipTests
              - name: Login Docker Hub
                run: echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
              - name: Builder docker image
                run: docker build -t FrancismarioCoelho/banking-api .
              - name: Push image docker
                run: docker push FrancismarioCoelho/banking-api
    deploy:
        needs: build
        runs-on: self-hosted
        steps:
           - name: Pull image from docker hub
             run: docker pull  FrancismarioCoelho/banking-api:latest
           - name: Run docker container
             run: docker run -d -p 8080:8080 --name deploy_aplication_api             

